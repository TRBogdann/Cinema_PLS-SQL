--1
CREATE TABLE P_Regizori(
ID_REGIZOR INT PRIMARY KEY,
PRENUME VARCHAR(30) NOT NULL,
NUME VARCHAR(30) NOT NULL,
TARA VARCHAR(30) NOT NULL
);

CREATE TABLE P_Filme(
ID_FILM INT PRIMARY KEY ,
NUME_FILM VARCHAR(40) NOT NULL,
DURATA_MINUTE NUMBER(3) NOT NULL,
DATA_LANSARE DATE NOT NULL,
CATEGORIE_VARSTA NUMBER(2) NOT NULL,
ID_REGIZOR INT NOT NULL REFERENCES P_Regizori(ID_REGIZOR),
CONSTRAINT CK_VARSTA CHECK(CATEGORIE_VARSTA IN(0,12,15,18))
);

CREATE TABLE P_Categorii(
ID_CATEGORIE INT PRIMARY KEY,
NUME_CATEGORIE VARCHAR(30) NOT NULL
);

CREATE TABLE P_Categorii_Film(
ID_CATEGORIE INT NOT NULL REFERENCES P_Categorii(ID_CATEGORIE),
ID_FILM INT NOT NULL REFERENCES P_Filme(ID_FILM)
);

CREATE TABLE P_Locatii(
ID_LOCATIE INT PRIMARY KEY,
ORAS VARCHAR(30) NOT NULL,
STRADA VARCHAR(30) NOT NULL
);

CREATE TABLE P_Angajati(
ID_ANGAJAT INT PRIMARY KEY,
NUME VARCHAR(30) NOT NULL,
PRENUME VARCHAR(30) NOT NULL,
SALARIUL NUMBER(6) NOT NULL,
FUNCTIE VARCHAR(30) NOT NULL,
ID_MANAGER INT REFERENCES P_Angajati(ID_ANGAJAT),
ID_LOCATIE INT NOT NULL REFERENCES P_Locatii(ID_LOCATIE),
CONSTRAINT CK_SALARIUL CHECK(SALARIUL>=3300)
);

CREATE TABLE P_Sali_Cinema(
ID_SALA INT PRIMARY KEY,
NR_RANDURI NUMBER(2) NOT NULL,
CAPACITATE_RAND NUMBER(2) NOT NULL,
ID_LOCATIE NOT NULL REFERENCES P_Locatii(ID_LOCATIE)
);

CREATE TABLE P_Program(
ID_VIZIONARE INT PRIMARY KEY,
DATA_VIZIONARE TIMESTAMP NOT NULL,
TIP_VIZIONARE VARCHAR(4) NOT NULL,
ID_FILM INT NOT NULL REFERENCES P_Filme(ID_FILM),
ID_SALA INT NOT NULL REFERENCES P_Sali_Cinema(ID_SALA),
CONSTRAINT CK_VIZ CHECK(TIP_VIZIONARE IN ('2D','3D','IMAX'))
);

CREATE TABLE P_Clienti(
ID_CLIENT INT PRIMARY KEY,
PRENUME VARCHAR(30) NOT NULL,
NUME VARCHAR(30) NOT NULL,
TELEFON VARCHAR(30) NOT NULL,
EMAIL VARCHAR(30) NOT NULL
);

CREATE TABLE P_Bilet(
ID_BILET INT PRIMARY KEY,
TIP_BILET VARCHAR(20) NOT NULL,
PRET NUMBER(2) NOT NULL,
NR_RAND NUMBER(2) NOT NULL,
NR_LOC NUMBER(2) NOT NULL,
ID_CLIENT INT NOT NULL REFERENCES P_Clienti(ID_CLIENT),
ID_VIZIONARE INT NOT NULL REFERENCES P_Program(ID_VIZIONARE)
);

ALTER TABLE P_CLIENTI
ADD CONSTRAINT CK_EMAIL CHECK(email LIKE '%_@__%.__%');

ALTER TABLE P_CLIENTI
ADD CONSTRAINT CK_TELEFON CHECK(telefon NOT LIKE '%[^0-9.]%');

--2
INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (1, 'Horror');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (2, 'Comedie');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (3, 'Actiune');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (4,'Aventura');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES(5,'Fantastic');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (6,'S-F');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES(7,'Animatie');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (8,'Biografie');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (9,'Drama');

INSERT INTO P_CATEGORII(ID_CATEGORIE,NUME_CATEGORIE)
VALUES (10,'Istoric');

INSERT INTO P_CATEGORII
VALUES (11,'Thriller');

INSERT INTO P_CATEGORII
VALUES (12,'Mister');

INSERT INTO P_REGIZORI
VALUES (1,'Bryce','McGuire','SUA');

INSERT INTO P_FILME
VALUES (1,'Ape Blestemate',89,TO_DATE('05/01/2024','DD,MM,YYYY'),15,1);

INSERT INTO P_REGIZORI
VALUES (2,'James','Wan','Australia');

INSERT INTO P_FILME
VALUES (2,'Aquaman Si Regatul Pierdut',124,TO_DATE('22/12/2023','DD,MM,YYYY'),12,2);

INSERT INTO P_REGIZORI
VALUES (3,'Ridley','Scott','Regatul Unit');

INSERT INTO P_FILME
VALUES (3,'Napoleon',158,TO_DATE('24/11/2023','DD,MM,YYYY'),15,3);

INSERT INTO P_REGIZORI
VALUES (4,'Bryce','McGuire','SUA');

INSERT INTO P_FILME
VALUES (4,'Thanksgiving',107,TO_DATE('01/12/2023','DD,MM,YYYY'),18,4);

INSERT INTO P_REGIZORI
VALUES (5,'Benjamin','Renner','Franta');

INSERT INTO P_FILME
VALUES (5,'Marea Migratie',92,TO_DATE('08/12/2023','DD,MM,YYYY'),0,5);

INSERT INTO P_REGIZORI
VALUES (6,'Paul','King','Regatul Unit');

INSERT INTO P_FILME
VALUES (6,'Wonka',116,TO_DATE('15/12/2023','DD,MM,YYYY'),0,6);

INSERT INTO P_REGIZORI
VALUES (7,'Michael','Mann','SUA');

INSERT INTO P_FILME
VALUES (7,'Ferrari',130,TO_DATE('05/01/2024','DD,MM,YYYY'),15,7);

INSERT INTO P_REGIZORI
VALUES (8,'David','Ayer ','SUA');

INSERT INTO P_FILME
VALUES (8,'The Beekeeper',105,TO_DATE('19/01/2024','DD,MM,YYYY'),12,8);

INSERT INTO P_CATEGORII_FILM
VALUES (1,1);

INSERT INTO P_CATEGORII_FILM
VALUES (3,2);

INSERT INTO P_CATEGORII_FILM
VALUES (4,2);

INSERT INTO P_CATEGORII_FILM
VALUES (5,2);

INSERT INTO P_CATEGORII_FILM
VALUES (3,3);

INSERT INTO P_CATEGORII_FILM
VALUES (8,3);

INSERT INTO P_CATEGORII_FILM
VALUES (10,3);

INSERT INTO P_CATEGORII_FILM
VALUES (9,3);

INSERT INTO P_CATEGORII_FILM
VALUES (1,4);

INSERT INTO P_CATEGORII_FILM
VALUES (11,4);

INSERT INTO P_CATEGORII_FILM
VALUES (12,4);

INSERT INTO P_CATEGORII_FILM
VALUES (2,5);

INSERT INTO P_CATEGORII_FILM
VALUES (7,5);

INSERT INTO P_CATEGORII_FILM
VALUES (4,6);

INSERT INTO P_CATEGORII_FILM
VALUES (5,6);

INSERT INTO P_CATEGORII_FILM
VALUES (8,7);

INSERT INTO P_CATEGORII_FILM
VALUES (10,7);

INSERT INTO P_CATEGORII_FILM
VALUES (3,8);

INSERT INTO P_LOCATII 
VALUES (1,'Rm.Valcea','Strada Ferdinand');

INSERT INTO P_LOCATII
VALUES (2,'Bucuresti','AFI');

INSERT INTO P_SALI_CINEMA
VALUES(1,10,20,1);

INSERT INTO P_SALI_CINEMA
VALUES(2,10,20,1);

INSERT INTO P_SALI_CINEMA
VALUES(3,8,16,1);

INSERT INTO P_SALI_CINEMA
VALUES(4,12,20,2);

INSERT INTO P_SALI_CINEMA
VALUES(5,12,20,2);

INSERT INTO P_SALI_CINEMA
VALUES(6,8,18,2);

INSERT INTO P_PROGRAM
VALUES(1,TIMESTAMP'2023-12-12 18:00:00','2D',1,3);

INSERT INTO P_PROGRAM
VALUES(2,TIMESTAMP'2024-01-23 19:00:00','2D',1,5);

INSERT INTO P_PROGRAM
VALUES(3,TIMESTAMP'2024-12-10 19:30:00','2D',1,5);

INSERT INTO P_PROGRAM
VALUES(1,TIMESTAMP'2023-12-12 18:00:00','2D',1,3);

INSERT INTO P_PROGRAM
VALUES(2,TIMESTAMP'2024-01-23 19:00:00','2D',1,5);

INSERT INTO P_PROGRAM
VALUES(3,TIMESTAMP'2023-12-10 19:30:00','2D',1,5);

INSERT INTO P_PROGRAM
VALUES(4,TIMESTAMP'2024-01-09 16:30:00','3D',2,1);

INSERT INTO P_PROGRAM
VALUES(5,TIMESTAMP'2024-01-18 12:00:00','3D',2,1);

INSERT INTO P_PROGRAM
VALUES(6,TIMESTAMP'2024-01-10 14:30:00','3D',2,4);

INSERT INTO P_PROGRAM
VALUES(7,TIMESTAMP'2024-01-14 18:30:00','IMAX',2,6);

INSERT INTO P_PROGRAM
VALUES(8,TIMESTAMP'2024-01-17 15:30:00','IMAX',3,2);

INSERT INTO P_PROGRAM
VALUES(9,TIMESTAMP'2024-01-02 13:00:00','IMAX',3,2);

INSERT INTO P_PROGRAM
VALUES(10,TIMESTAMP'2024-01-20 12:00:00','3D',3,4);

INSERT INTO P_PROGRAM
VALUES(11,TIMESTAMP'2024-01-21 15:30:00','IMAX',3,5);

INSERT INTO P_PROGRAM
VALUES(12,TIMESTAMP'2023-12-30 15:30:00','2D',4,3);

INSERT INTO P_PROGRAM
VALUES(13,TIMESTAMP'2024-01-28 21:00:00','2D',4,3);

INSERT INTO P_PROGRAM
VALUES(14,TIMESTAMP'2024-01-10 18:30:00','2D',4,6);

INSERT INTO P_PROGRAM
VALUES(15,TIMESTAMP'2024-01-30 15:30:00','3D',5,1);

INSERT INTO P_PROGRAM
VALUES(16,TIMESTAMP'2024-01-04 14:00:00','3D',5,2);

INSERT INTO P_PROGRAM
VALUES(17,TIMESTAMP'2024-01-08 12:30:00','3D',5,5);

INSERT INTO P_PROGRAM
VALUES(18,TIMESTAMP'2024-01-08 16:45:00','3D',6,1);

INSERT INTO P_PROGRAM
VALUES(19,TIMESTAMP'2024-01-10 17:30:00','3D',6,2);

INSERT INTO P_PROGRAM
VALUES(20,TIMESTAMP'2024-01-12 11:30:00','IMAX',6,6);

INSERT INTO P_PROGRAM
VALUES(21,TIMESTAMP'2024-01-11 18:00:00','3D',6,4);

INSERT INTO P_PROGRAM
VALUES(22,TIMESTAMP'2024-01-08 17:45:00','3D',7,3);

INSERT INTO P_PROGRAM
VALUES(23,TIMESTAMP'2024-01-10 17:15:00','3D',7,5);

INSERT INTO P_PROGRAM
VALUES(24,TIMESTAMP'2024-02-12 14:30:00','IMAX',8,1);

INSERT INTO P_PROGRAM
VALUES(25,TIMESTAMP'2024-02-05 17:15:00','3D',8,2);

INSERT INTO P_PROGRAM
VALUES(26,TIMESTAMP'2024-02-07 19:30:00','IMAX',8,4);

INSERT INTO P_ANGAJATI
VALUES(1,'Catalin','Marcel',20000,'manager',NULL,2);

INSERT INTO P_ANGAJATI
VALUES(2,'Dorin','Razvan',7000,'asistent manager',1,2);

INSERT INTO P_ANGAJATI
VALUES(3,'Paula','Stefania',7000,'asistent manager',1,1);

INSERT INTO P_ANGAJATI
VALUES(5,'Andrei','Nicolae',FLOOR(DBMS_RANDOM.value(3700,4200)),'portar',2,2);

INSERT INTO P_ANGAJATI
VALUES(6,'Remus','Octavian',FLOOR(DBMS_RANDOM.value(3700,4200)),'portar',2,2);

INSERT INTO P_ANGAJATI
VALUES(7,'Vlad','Iancu',FLOOR(DBMS_RANDOM.value(3700,4200)),'portar',3,1);

INSERT INTO P_ANGAJATI
VALUES(8,'Adrian','Lazar',FLOOR(DBMS_RANDOM.value(3700,4200)),'portar',3,2);

INSERT INTO P_ANGAJATI
VALUES(9,'Sorin','Ionut',FLOOR(DBMS_RANDOM.value(3700,4200)),'portar',3,2);

INSERT INTO P_ANGAJATI
VALUES(10,'Amalia','Lidia',FLOOR(DBMS_RANDOM.value(3300,3700)),'ingrijitor',2,2);

INSERT INTO P_ANGAJATI
VALUES(11,'Emil','Cezar',FLOOR(DBMS_RANDOM.value(3300,3700)),'ingrijitor',2,2);

INSERT INTO P_ANGAJATI
VALUES(12,'Catalina','Matei',FLOOR(DBMS_RANDOM.value(3300,3700)),'ingrijitor',3,1);

INSERT INTO P_ANGAJATI
VALUES(13,'Mirela','Andreea',FLOOR(DBMS_RANDOM.value(3300,3700)),'ingrijitor',3,1);

UPDATE P_ANGAJATI
SET ID_LOCATIE=1
WHERE ID_MANAGER=3;

INSERT INTO P_ANGAJATI
VALUES(14,'Aurel','Drogomir',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',2,2);

INSERT INTO P_ANGAJATI
VALUES(15,'Robert','Tudor',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',2,2);

INSERT INTO P_ANGAJATI
VALUES(16,'Valeriu','Ionel',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',2,2);

INSERT INTO P_ANGAJATI
VALUES(17,'Petrut','Lavinia',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',2,2);

INSERT INTO P_ANGAJATI
VALUES(18,'Sofia','Andrei',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',3,1);

INSERT INTO P_ANGAJATI
VALUES(19,'Antonio','David',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',3,1);

INSERT INTO P_ANGAJATI
VALUES(20,'Emilia','Tudor',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',3,1);

INSERT INTO P_ANGAJATI
VALUES(21,'Mirel','Andrei',FLOOR(DBMS_RANDOM.value(3700,4200)),'casier',3,1);

INSERT INTO P_ANGAJATI
VALUES(22,'Isabela','Antonia',FLOOR(DBMS_RANDOM.value(4300,4800)),'proiectionist',2,2);

INSERT INTO P_ANGAJATI
VALUES(23,'Angela','Horatiu',FLOOR(DBMS_RANDOM.value(4300,4800)),'proiectionist',2,2);

INSERT INTO P_ANGAJATI
VALUES(24,'Luslec','Cosmic',FLOOR(DBMS_RANDOM.value(4300,4800)),'proiectionist',3,1);

INSERT INTO P_ANGAJATI
VALUES(25,'Laura','Nicol',FLOOR(DBMS_RANDOM.value(4300,4800)),'proiectionist',3,1);

INSERT INTO P_CLIENTI
VALUES(1,'Ion','Ionescu','07310485921','a@gmail.com');

INSERT INTO P_CLIENTI
VALUES(2,'Leana','Isac','07320485234','b@gmail.com');

INSERT INTO P_CLIENTI
VALUES(3,'Dariu','Matei','07320485234','b@gmail.com');

INSERT INTO P_CLIENTI
VALUES(4,'Adrian','Sorin','07421124241','ba@gmail.com');

INSERT INTO P_CLIENTI
VALUES(5,'Diana','Maria','07421124421','ab@gmail.com');

INSERT INTO P_CLIENTI
VALUES(6,'Alex','Mihai','07312478787','abcg@gmail.com');

INSERT INTO P_CLIENTI
VALUES(7,'Marinela','Ana','07312489124','befw@gmail.com');

INSERT INTO P_CLIENTI
VALUES(8,'Lidia','Sara','07217824189','bfew@gmail.com');

INSERT INTO P_CLIENTI
VALUES(9,'Miron','Marin','07124907685','btr@gmail.com');

INSERT INTO P_CLIENTI
VALUES(10,'Gabriel','Andrei','07143452566','qeer@gmail.com');

INSERT INTO P_BILET
VALUES(1,'pensionar',10,2,10,1,1);

INSERT INTO P_BILET
VALUES(2,'pensionar',13,3,14,1,8);

INSERT INTO P_BILET
VALUES(3,'pensionar',9,5,1,1,22);

INSERT INTO P_BILET
VALUES(4,'bilet intreg',11,8,12,2,7);

INSERT INTO P_BILET
VALUES(5,'bilet intreg',26,2,14,2,20);

INSERT INTO P_BILET
VALUES(6,'bilet intreg',23,3,4,3,9);

INSERT INTO P_BILET
VALUES(7,'bilet intreg',16,1,1,3,8);

INSERT INTO P_BILET
VALUES(8,'bilet intreg',11,9,13,4,5);

INSERT INTO P_BILET
VALUES(9,'bilet intreg',8,11,4,4,8);

INSERT INTO P_BILET
VALUES(13,'student',9,2,11,6,3);

INSERT INTO P_BILET
VALUES(12,'student',11,5,8,6,26);

UPDATE P_BILET
SET tip_bilet='elev'
WHERE id_client=4;

INSERT INTO P_BILET
VALUES(15,'student',8,8,9,8,20);

INSERT INTO P_BILET
VALUES(16,'student',8,6,7,8,23);
 
INSERT INTO P_BILET
VALUES(19,'bilet intreg',16,2,12,10,21);

INSERT INTO P_BILET
VALUES(20,'bilet intreg',23,5,9,10,25);


--3

--creare Index 
CREATE INDEX f_index
ON p_filme(nume_film);

--Costurile cu angajati
SELECT SUM(SALARIUl) FROM
(SELECT ID_ANGAJAT,SALARIUL FROM P_ANGAJATI
MINUS
SELECT ID_ANGAJAT,SALARIUL FROM P_ANGAJATI
WHERE UPPER(FUNCTIE)='MANAGER' OR UPPER(FUNCTIE)='ASISTENT MANAGER'
);

--Totalul generat de fiecare film
SELECT f.id_film,f.nume_film,sum(b.pret)
FROM p_filme f
JOIN p_program p
ON p.id_film=f.id_film
JOIN p_bilet b
ON b.id_vizionare=p.id_vizionare
GROUP BY f.id_film,f.nume_film;

--Suma generata de fiecare cinema si suma totala 
SELECT l.oras,sum(b.pret)
FROM p_locatii l
JOIN p_sali_cinema s
ON s.id_locatie=l.id_locatie
JOIN p_program p
ON p.id_sala=s.id_sala
JOIN p_bilet b
ON b.id_vizionare=p.id_vizionare
GROUP by ROLLUP(l.oras);

--Nr Locuri sala
SELECT id_sala,capacitate_rand*nr_randuri,
CASE
    WHEN capacitate_rand*nr_randuri BETWEEN 0 AND 100  THEN 'sali mici'
    WHEN capacitate_rand*nr_randuri BETWEEN 100 AND 150 THEN 'sali medii'
    ELSE 'sali mari'
END as Categorie
FROM p_sali_cinema;

--Nr Locuri libere pentru fiecare spectacol
SELECT p.id_vizionare,f.nume_film,s.id_sala,s.nr_randuri*s.capacitate_rand-count(b.id_bilet) "Nr_locuri Libere"
FROM p_program p
JOIN p_filme f
ON p.id_film=f.id_film
JOIN p_bilet b
ON b.id_vizionare=p.id_vizionare
JOIN p_sali_cinema s
ON s.id_sala=p.id_sala
GROUP BY p.id_vizionare,f.nume_film,s.id_sala,s.nr_randuri,s.capacitate_rand;

--Afisare locuri libere pt un spectacol

CREATE TABLE temp AS
SELECT LEVEL N FROM DUAL CONNECT BY LEVEL <= (SELECT NR_RANDURI FROM P_SALI_CINEMA WHERE id_sala=(SELECT id_sala FROM p_program WHERE id_vizionare=6));

CREATE TABLE temp2 AS
SELECT LEVEL N FROM DUAL CONNECT BY LEVEL <= (SELECT CAPACITATE_RAND FROM P_SALI_CINEMA WHERE id_sala=(SELECT id_sala FROM p_program WHERE id_vizionare=6));

SELECT * from temp
CROSS JOIN temp2
MINUS
SELECT b.nr_rand,b.nr_loc
FROM p_bilet b
JOIN p_program p
ON p.id_vizionare=b.id_vizionare
WHERE p.id_vizionare=6;

DROP TABLE temp;
DROP TABLE temp2;

--Filme care nu se mai difuzeaza
SELECT f.id_film,f.nume_film,MAX(p.data_vizionare)
FROM p_filme f
JOIN p_program p
ON p.id_film=f.id_film
GROUP by f.id_film,f.nume_film
HAVING MAX(p.data_vizionare)<SYSDATE;

--Bilete pentru spectacole urmatoare
SELECT count(b.id_bilet),f.nume_film
FROM p_bilet b
JOIN p_program p
ON p.id_vizionare=b.id_vizionare
JOIN p_filme f
ON p.id_film=f.id_film
GROUP BY f.nume_film
HAVING MAX(p.data_vizionare)>=SYSDATE;

--Filme ce nu au fost lansate inca
SELECT nume_film FROM p_filme
WHERE data_lansare>SYSDATE;

--Cele mai populare filme

SELECT count(b.id_bilet),f.nume_film
FROM p_bilet b
JOIN p_program p
ON p.id_vizionare=b.id_vizionare
JOIN p_filme f
ON p.id_film=f.id_film
GROUP BY f.nume_film
ORDER BY count(b.id_bilet) desc;

--Ierarhie 

SELECT LPAD(' ', 2*level-1)||SYS_CONNECT_BY_PATH(nume, '/') "Ierarhie"
FROM p_angajati
START WITH id_angajat=1
CONNECT BY PRIOR id_angajat = id_manager;

--Crestrea salariului pentru angajtii aflat pe nivelul 2 in ierarhie

CREATE VIEW pang_view AS
SELECT id_angajat,salariul,level "nivel"
FROM p_angajati
START WITH id_angajat=1
CONNECT BY PRIOR id_angajat = id_manager;

UPDATE pang_view 
SET salariul=salariul*1.3
WHERE "nivel"=2;

SELECT * FROM pang_view;

--Top 5 cele mai vizualizate categorii
SELECT ROWNUM ,nume_categorie
FROM (SELECT c.nume_categorie,count(b.id_bilet)
FROM p_categorii c,p_categorii_film cf, p_filme f, p_program p, p_bilet b
WHERE c.id_categorie=cf.id_categorie AND f.id_film=cf.id_film AND
p.id_film=f.id_film AND b.id_vizionare=p.id_vizionare
GROUP BY c.nume_categorie
ORDER BY count(b.id_bilet))
WHERE ROWNUM<=5;

